<!-- HTML for static distribution bundle build -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Swagger UI</title>
    <link rel="stylesheet" type="text/css" href="./swagger-ui.css" >
    <link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16" />
    <style>
      html
      {
        box-sizing: border-box;
        overflow: -moz-scrollbars-vertical;
        overflow-y: scroll;
      }

      *,
      *:before,
      *:after
      {
        box-sizing: inherit;
      }

      body
      {
        margin:0;
        background: #fafafa;
      }
    </style>
  </head>

  <body>
    <div id="swagger-ui"></div>

    <script src="./swagger-ui-bundle.js"> </script>
    <script src="./swagger-ui-standalone-preset.js"> </script>    
    
    <script>
    
    window.onload = function() {        
        //experiment components wrapping       
        
        const MyApiKeyAuthPlugin = function() {
        return {
          statePlugins: {
            auth: {
              wrapActions: {
                  authorize: (oriAction, system) => (payload) => {
                      //get currently running server:port
                  let currServer = system.oas3Selectors.selectedServer();                  
                  let err = system.errActions;
                  //clear any existing auth errors
                  err.clear({ source: "auth" });
                  if(payload && payload.ConstellationSecret && payload.ConstellationSecret.value) {
                      if ( payload.ConstellationSecret.value.trim().length > 0) {
                          //call any example endpoint to check authorization with entered secret
                            fetch(`${currServer}/v2/service/reflect_json`, {
                              method: 'POST',
                              headers: {
                                'Content-Type': 'application/json',                      
                                'accept': '*/*',
                                'X-CONSTELLATION-SECRET':payload.ConstellationSecret.value
                              }
                            }).then(response => {
                                // Check if the response was successful (e.g., status code 200-299)
                                if (!response.ok) {
                                    err.newAuthErr( {
                                      authId: "ConstellationSecret",
                                      source: "auth",
                                      level: "error",
                                      message: `HTTP error! status: ${response.status} ${response.statusText}`
                                    });
                                  return;
                                }
                                // Parse the response body as JSON
                                return oriAction(payload);
                              }) .catch(error => {
                                  err.newAuthErr( {
                                        authId: "ConstellationSecret",
                                        source: "auth",
                                        level: "error",
                                        message: `Error connecting to the rest server`
                                    });                                    
                                  return;
                              });
                      } else {
                          err.newAuthErr( {
                              authId: "ConstellationSecret",
                              source: "auth",
                              level: "error",
                              message: `ConstellationSecret can not be empty`
                          });
                          return;
                      }
                      
                  } else {
                     err.newAuthErr( {
                              authId: "ConstellationSecret",
                              source: "auth",
                              level: "error",
                              message: `ConstellationSecret can not be empty`
                          });
                          return;
                  }     
                }
              }
            }
          }
        };
      };    

      // Begin Swagger UI call region
      const ui = SwaggerUIBundle({
        url: "/swagger/constellation.json",
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [            
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],        
        plugins: [
          SwaggerUIBundle.plugins.DownloadUrl,          
          MyApiKeyAuthPlugin          
        ],        
        layout: "StandaloneLayout"
      })
      // End Swagger UI call region

      window.ui = ui
    }
  </script>
  </body>
</html>